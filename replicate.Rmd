---
title: "replication"
author: "Nick F & Aaron K"
date: "February 24, 2015"
output: html_document
---

2/28/15 - NF - Starting at 1a
```{r echo = FALSE}
library(dplyr)
library(broom)
library(ggplot2)
library(foreign)
library(aod)
library(lsr)

Sem <- function(x) {
  #creates the function to calculate standard error of the mean
  sqrt(var(x)/length(x))
  }

```

---
#Study 1a
In this study, there were 103 participants (median household size = 3 people, median household income = $35,000).  We were unable to replicate sex breakdown and mean age of participants as this data was not provided in the released dataset.
```{r echo = FALSE}
setwd("C:/Users/Nick/Documents/Github/scarcityvalueRep/framing")
raw_1a_spss <- read.spss("study_1a.sav", to.data.frame = TRUE)
#read in the data for 1a using the spss file - the warning that comes up is okay - the data imports cleanly.

raw_1a_spss %>%
  summarise(sample.size = n(), median.household.income = median(income2), median.household.size = median(house))

# OR 
getwd() #check it's in "replicate" folder

```

***Results***
------
One participant was excluded as an outlier on income (more than 3 SD from the mean).  Binary logistic regressions were conducted to compare how frequently participants cided each of the two considerations of interest (trade-offs vs location) as a function of income.


sidenote: of the 102 participants, only 58 cited either trade-off or location.  Presumably, the other 44 participants cited another response that was not analyzed.



```{r echo = FALSE}
clean_1a <- raw_1a_spss %>%
  filter(filter_. != "Not Selected")
#removes the 1 removed observation for being 3 SDs away from the mean.

raw_1a_spss  %>%
  summarise(total.tradeoff = sum(tradeoff), total.location = sum(location))
#count number of participants who answered either 'tradeoff' or 'location' for the 1a prompt.
```

Higher-income participants were more likely than lower-income participants to name location as their main consideration, beta = 2.52, Wald-test chi squared(1, N = 102) = 5.5, p < 0.05.

```{r echo = FALSE}

logit1logses <- glm(location ~ logses, data = clean_1a, family = "binomial")
summary(logit1logses)

wald.test(b = coef(logit1logses), Sigma = vcov(logit1logses), Terms = 2)

```

Lower-income participants were more likely than higher-income participants to name trade-offs as the main consideration, beta = -1.62, Wald-test chi squared(1, N = 102) = 4.7, p < 0.05.

```{r echo = FALSE}
logit2logses <- glm(tradeoff ~ logses, data = clean_1a, family = "binomial")
summary(logit2logses)

wald.test(b = coef(logit2logses), Sigma = vcov(logit2logses), Terms = 2)
```
------
------
Below are the numbers for figure 1a - currently figuring out how to make them into a histogram.
```{r echo = FALSE}
clean_1a %>%
  filter(income2 <= 35000) %>%
  summarise(total.n = n(), total.tradeoff = sum(tradeoff), prop.tradeoff = sum(tradeoff)/n(), total.location = sum(location), prop.location = sum(location)/n())
#produces numbers for the low income bars

clean_1a %>%
  filter(income2 > 35000) %>%
  summarise(total.n = n(), total.tradeoff = sum(tradeoff), prop.tradeoff = sum(tradeoff)/n(), total.location = sum(location), prop.location = sum(location)/n())
#produces numbers for the high income bars

```
-----
-----

#Study 1b

In Study 1b, there were 151 participants (median household size = 3 people, median household income = $45000). We were unable to replicate sex breakdown and mean age of participants as this data was not provided in the released dataset.

```{r echo = FALSE}

setwd("C:/Users/Nick/Documents/Github/scarcityvalueRep/framing")
raw_1b_spss <- read.spss("study_1b.sav", to.data.frame = TRUE)
#read in the data for 1b using the spss file - the warning that comes up is okay - the data imports cleanly.

raw_1b_spss %>%
  summarise(sample.size = n(), median.household.income = median(income2), median.household.size = median(house))
```

***Results***
-----
In Study 1b, 2 participants were excluded whose Willing-to-pay (WTP) was more than 3 standard deviations from the mean.

Higher-income participants showed the classic effect, offering a higher price for beer from the resort

```{r echo = FALSE}

clean_1b <- raw_1b_spss %>%
  filter(filter_. != "Not Selected")

clean_1b %>%
  filter(split == 1, resort == 1) %>%
  summarise(mean.beer = mean(beer), ci.low = mean(beer) -  (1.96 * sem(beer)), ci.high = mean(beer) + (1.96 * sem(beer)))
#1.96 * standard error gives 95% CI in one direction
#this calculates high-income WTP beer price at resort
```
compared to the grocery store.

```{r echo = FALSE}
clean_1b %>%
  filter(split == 1, resort == 0) %>%
  summarise(mean.beer = mean(beer), ci.low = mean(beer) -  (1.96 * sem(beer)), ci.high = mean(beer) + (1.96 * sem(beer)))
#1.96 * standard error gives 95% CI in one direction
#this calculates high-income WTP beer price at grocer

```
But lower income participants' WTP did not differ significantly between beer from the resort

```{r echo = FALSE}
clean_1b %>%
  filter(split == 0, resort == 1) %>%
  summarise(mean.beer = mean(beer), ci.low = mean(beer) -  (1.96 * sem(beer)), ci.high = mean(beer) + (1.96 * sem(beer)))
#1.96 * standard error gives 95% CI in one direction
#this calculates low income WTP beer price at resort

```
 and beer from the store.
 
```{r echo = FALSE}
clean_1b %>%
  filter(split == 0, resort == 0) %>%
  summarise(mean.beer = mean(beer), ci.low = mean(beer) -  (1.96 * sem(beer)), ci.high = mean(beer) + (1.96 * sem(beer)))
#1.96 * standard error gives 95% CI in one direction
#this calculates low income WTP beer price at grocery store

```

The interaction between income and context was significant F(1,145) = 11.18, p < 0.01, eta squared partial = 0.07.
```{r echo = FALSE}
aov_1b <- aov(beer ~ resort * split, data = clean_1b)
summary(aov_1b)
#they ran this anova on the binary 'split' column?

etaSquared(aov_1b, type = 2, anova = FALSE)
```
The interaction was also significant when income was treated as a continuous variable beta = 2.27 (the closest I could replicate from the data was 2.67), t(145) = 2.17, p < 0.05.

```{r echo = FALSE}
lm1 <- lm(beer ~ resort * logses, data = clean_1b)
summary(lm1)
```
-----
-----
#Study 1c


We replicated the results of 1b with larger samples in studies 1c and 1d.  In study 1c, we excluded 2 participants with missing responses, 5 with unreasonably high WTPs (over $100), and 19 additional outliers on WTP, which left 578 participants.

```{r echo = FALSE}
setwd("C:/Users/Nick/Documents/Github/scarcityvalueRep/framing")
raw_1c_spss <- read.spss("study_1c.sav", to.data.frame = TRUE)
#read in the data for 1c using the spss file - the warning that comes up is okay - the data imports cleanly.

clean_1c <- raw_1c_spss %>%
  filter(filter_. != "Not Selected")
```
***Results***
-----

Dividing participants according to a median split on income, we found that higher-income participants offered a higher price for beer from the resort

```{r echo = FALSE}
clean_1c %>%
  filter(split == 1, resort == 1) %>%
  summarise(mean.beer = mean(pay), ci.low = mean(pay) -  (1.96 * sem(pay)), ci.high = mean(pay) + (1.96 * sem(pay)))
```
than for beer from the grocery store:
```{r echo = FALSE}
clean_1c %>%
  filter(split == 1, resort == 0) %>%
  summarise(mean.beer = mean(pay), ci.low = mean(pay) -  (1.96 * sem(pay)), ci.high = mean(pay) + (1.96 * sem(pay)))
```

Lower-income participants' WTP did not differ significantly between beer from the resort,

```{r echo = FALSE}
clean_1c %>%
  filter(split == 0, resort == 1) %>%
  summarise(mean.beer = mean(pay), ci.low = mean(pay) -  (1.96 * sem(pay)), ci.high = mean(pay) + (1.96 * sem(pay)))
```
and beer from the store.

```{r echo = FALSE}
clean_1c %>%
  filter(split == 0, resort == 0) %>%
  summarise(mean.beer = mean(pay), ci.low = mean(pay) -  (1.96 * sem(pay)), ci.high = mean(pay) + (1.96 * sem(pay)))
```

The interaction between income and context was significant, F(1,574) = 5.68, p < 0.05, eta squared partial = 0.01.

```{r echo = FALSE}
aov_1c <- aov(pay ~ resort * split, data = clean_1c)
summary(aov_1c)
#they ran this anova on the binary 'split' column?

etaSquared(aov_1c, type = 2, anova = FALSE)
```
